<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PWA Meta Tags -->
<meta name="theme-color" content="#007bff"/>
<link rel="apple-touch-icon" href="icons/icon-192x192.png">
<link rel="manifest" href="manifest.json">

<title>Horario de Medicamentos Cenen</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    font-family: 'Inter', sans-serif;
  }
  .time-block {
    transition: all 0.5s ease-in-out;
  }
</style>
</head>
<body class="bg-gray-100">

<div class="container mx-auto max-w-2xl p-4">
  <header class="bg-blue-600 text-white p-6 rounded-t-xl shadow-lg text-center">
    <h1 class="text-2xl font-bold">Horario de Medicamentos Cenen</h1>
    <button id="enable-notifications-btn" class="mt-4 bg-white text-blue-600 font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-100 transition-colors">
        Activar Notificaciones üîî
    </button>
    <p id="notification-status" class="text-xs mt-2 h-4"></p>
  </header>

  <main class="bg-white rounded-b-xl shadow-lg">
    <!-- Schedule starts here -->
    
    <div id="block-0000" data-time="00:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">12:00 am</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4">
        <div>
          <p class="font-bold text-gray-800">Aciclovir Genfar</p>
          <p class="text-sm text-gray-500">Antiviral</p>
        </div>
      </div>
    </div>

    <div id="block-0100" data-time="01:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">1:00 am</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4 space-y-4">
        <div>
          <p class="font-bold text-gray-800">Hioscina N-butilbromuro</p>
          <p class="text-sm text-gray-500">Antiespasm√≥dico</p>
        </div>
        <div class="border-t border-gray-200 pt-4">
          <p class="font-bold text-gray-800">Acetaminofen</p>
          <p class="text-sm text-gray-500">Analg√©sico/antipir√©tico</p>
          <div class="mt-2 p-2 bg-yellow-100 border-l-4 border-yellow-400 text-yellow-800 text-xs rounded-r-lg">
            ü§î Opcional si hay dolor
          </div>
        </div>
      </div>
    </div>

    <div id="block-0500" data-time="05:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">5:00 am</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4 space-y-4">
        <div>
          <p class="font-bold text-gray-800">Eliquis <span class="text-gray-500 font-normal">(Apixaban)</span></p>
          <p class="text-sm text-gray-500">Anticoagulante</p>
        </div>
        <div class="border-t border-gray-200 pt-4">
          <p class="font-bold text-gray-800">Esomeprazol <span class="text-gray-500 font-normal">(Omeprazol)</span></p>
          <p class="text-sm text-gray-500">Protector g√°strico</p>
        </div>
      </div>
    </div>
    
    <div id="block-0800" data-time="08:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">8:00 am</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4 space-y-4">
        <div>
          <p class="font-bold text-gray-800">Janumet</p>
          <p class="text-sm text-gray-500">Antidiab√©tico</p>
           <div class="mt-2 p-2 bg-green-100 border-l-4 border-green-400 text-green-800 text-xs rounded-r-lg">
            ü•ê Con el desayuno
          </div>
        </div>
        <div class="border-t border-gray-200 pt-4">
          <p class="font-bold text-gray-800">Albisan</p>
          <p class="text-sm text-gray-500">Antidiab√©tico</p>
          <div class="mt-2 p-2 bg-green-100 border-l-4 border-green-400 text-green-800 text-xs rounded-r-lg">
            ü¶∑ Despu√©s de cada comida
          </div>
        </div>
         <div class="border-t border-gray-200 pt-4">
          <p class="font-bold text-gray-800">Aciclovir Genfar</p>
          <p class="text-sm text-gray-500">Antiviral</p>
        </div>
      </div>
    </div>

    <div id="block-0900" data-time="09:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">9:00 am</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4 space-y-4">
        <div>
            <p class="font-bold text-gray-800">Hioscina N-butilbromo</p>
            <p class="text-sm text-gray-500">Antiespasm√≥dico</p>
        </div>
        <div class="border-t border-gray-200 pt-4">
            <p class="font-bold text-gray-800">Acetaminofen</p>
            <p class="text-sm text-gray-500">Analg√©sico/antipir√©tico</p>
            <div class="mt-2 p-2 bg-yellow-100 border-l-4 border-yellow-400 text-yellow-800 text-xs rounded-r-lg">
                ü§î Opcional si hay dolor
            </div>
        </div>
        <div class="border-t border-gray-200 pt-4">
          <p class="font-bold text-gray-800">Zyloprim <span class="text-gray-500 font-normal">(Alopurinol)</span></p>
          <p class="text-sm text-gray-500">Disminuir √°cido √∫rico</p>
        </div>
      </div>
    </div>

    <div id="block-1000" data-time="10:00" class="time-block flex items-start p-4 border-b border-gray-200">
        <div class="w-24 flex-shrink-0 text-right pr-4">
            <span class="text-lg font-semibold text-blue-600">10:00 am</span>
            <div class="chip-container mt-1"></div>
        </div>
        <div class="flex-grow border-l border-gray-200 pl-4">
            <p class="font-bold text-gray-800">Colchimedio <span class="text-gray-500 font-normal">(Colchicina)</span></p>
            <p class="text-sm text-gray-500">Para la gota</p>
        </div>
    </div>

    <div id="block-1100" data-time="11:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">11:00 am</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4 space-y-4">
        <div>
          <p class="font-bold text-gray-800">Betaloc ZOK</p>
          <p class="text-sm text-gray-500">Antihipertensivo</p>
        </div>
        <div class="border-t border-gray-200 pt-4">
          <p class="font-bold text-gray-800">Spiriva Respimat</p>
          <p class="text-sm text-gray-500">Broncodilatador</p>
        </div>
      </div>
    </div>
    
    <div id="block-1300" data-time="13:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">1:00 pm</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4 space-y-4">
        <div>
          <p class="font-bold text-gray-800">Albisan</p>
          <p class="text-sm text-gray-500">Antidiab√©tico</p>
          <div class="mt-2 p-2 bg-green-100 border-l-4 border-green-400 text-green-800 text-xs rounded-r-lg">
            ü¶∑ Despu√©s de cada comida
          </div>
        </div>
        <div class="border-t border-gray-200 pt-4">
          <p class="font-bold text-gray-800">Vitamina D3</p>
          <p class="text-sm text-gray-500">Vitamina</p>
           <div class="mt-2 p-2 bg-green-100 border-l-4 border-green-400 text-green-800 text-xs rounded-r-lg">
            ü•ó Despu√©s del almuerzo
          </div>
        </div>
      </div>
    </div>
    
    <div id="block-1500" data-time="15:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">3:00 pm</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4">
        <p class="font-bold text-gray-800">Amlodipino Genfar</p>
        <p class="text-sm text-gray-500">Antihipertensivo</p>
      </div>
    </div>

    <div id="block-1600" data-time="16:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">4:00 pm</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4 space-y-4">
        <div>
          <p class="font-bold text-gray-800">Aciclovir Genfar</p>
          <p class="text-sm text-gray-500">Antiviral</p>
        </div>
        <div class="border-t border-gray-200 pt-4">
          <p class="font-bold text-gray-800">Hioscina N-butilbromo</p>
          <p class="text-sm text-gray-500">Antiespasm√≥dico</p>
        </div>
      </div>
    </div>
    
    <div id="block-1700" data-time="17:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">5:00 pm</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4 space-y-4">
        <div>
          <p class="font-bold text-gray-800">Acetaminofen</p>
          <p class="text-sm text-gray-500">Analg√©sico/antipir√©tico</p>
          <div class="mt-2 p-2 bg-yellow-100 border-l-4 border-yellow-400 text-yellow-800 text-xs rounded-r-lg">
            ü§î Opcional si hay dolor
          </div>
        </div>
        <div class="border-t border-gray-200 pt-4">
          <p class="font-bold text-gray-800">Eliquis <span class="text-gray-500 font-normal">(Apixaban)</span></p>
          <p class="text-sm text-gray-500">Anticoagulante</p>
        </div>
        <div class="border-t border-gray-200 pt-4">
          <p class="font-bold text-gray-800">Trimetoprim Genfar</p>
          <p class="text-sm text-gray-500">Antibi√≥tico</p>
          <div class="mt-2 p-2 bg-red-100 border-l-4 border-red-500 text-red-800 text-xs rounded-r-lg">
            üö® Lunes, Mi√©rcoles y Viernes. √önica dosis.
          </div>
        </div>
      </div>
    </div>

    <div id="block-1900" data-time="19:00" class="time-block flex items-start p-4 border-b border-gray-200">
        <div class="w-24 flex-shrink-0 text-right pr-4">
            <span class="text-lg font-semibold text-blue-600">7:00 pm</span>
            <div class="chip-container mt-1"></div>
        </div>
        <div class="flex-grow border-l border-gray-200 pl-4">
            <p class="font-bold text-gray-800">Albisan</p>
            <p class="text-sm text-gray-500">Antidiab√©tico</p>
            <div class="mt-2 p-2 bg-green-100 border-l-4 border-green-400 text-green-800 text-xs rounded-r-lg">
                ü¶∑ Despu√©s de cada comida
            </div>
        </div>
    </div>
    
    <div id="block-2000" data-time="20:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">8:00 pm</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4">
        <p class="font-bold text-gray-800">Constilax</p>
        <p class="text-sm text-gray-500">Laxante</p>
        <div class="mt-2 p-2 bg-green-100 border-l-4 border-green-400 text-green-800 text-xs rounded-r-lg">
          üåô Despu√©s de la cena
        </div>
      </div>
    </div>
    
    <div id="block-2100" data-time="21:00" class="time-block flex items-start p-4 border-b border-gray-200">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">9:00 pm</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4">
        <p class="font-bold text-gray-800">Trelegy</p>
        <p class="text-sm text-gray-500">Broncodilatador</p>
      </div>
    </div>
    
    <div id="block-2300" data-time="23:00" class="time-block flex items-start p-4">
      <div class="w-24 flex-shrink-0 text-right pr-4">
        <span class="text-lg font-semibold text-blue-600">11:00 pm</span>
        <div class="chip-container mt-1"></div>
      </div>
      <div class="flex-grow border-l border-gray-200 pl-4">
        <p class="font-bold text-gray-800">Insulina</p>
        <p class="text-sm text-gray-500">Control de glucosa</p>
      </div>
    </div>
  </main>

</div>

<script>
  // --- UI LOGIC ---
  function updateMedicationStatusUI() {
    const now = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Bogota' }));
    const currentTimeInMinutes = now.getHours() * 60 + now.getMinutes();
    const timeBlocks = document.querySelectorAll('.time-block');
    let nextMedFound = false;

    timeBlocks.forEach(block => {
      block.classList.remove('opacity-40', 'scale-105', 'shadow-xl', 'relative', 'z-10', 'bg-white');
      const chipContainer = block.querySelector('.chip-container');
      if (chipContainer) chipContainer.innerHTML = '';
    });

    for(const block of timeBlocks) {
      const [hours, minutes] = block.dataset.time.split(':').map(Number);
      const blockTimeInMinutes = hours * 60 + minutes;

      if (blockTimeInMinutes < currentTimeInMinutes) {
        block.classList.add('opacity-40');
      }

      if (!nextMedFound && blockTimeInMinutes >= currentTimeInMinutes) {
        block.classList.add('scale-105', 'shadow-xl', 'relative', 'z-10', 'bg-white');
        const chipContainer = block.querySelector('.chip-container');
        if (chipContainer) chipContainer.innerHTML = '<span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">Siguiente</span>';
        nextMedFound = true;
      }
    }
    if (!nextMedFound && timeBlocks.length > 0) {
        const firstBlock = timeBlocks[0];
        firstBlock.classList.add('scale-105', 'shadow-xl', 'relative', 'z-10', 'bg-white');
        const chipContainer = firstBlock.querySelector('.chip-container');
        if (chipContainer) chipContainer.innerHTML = '<span class="inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">Siguiente</span>';
    }
  }

  // --- PWA & NOTIFICATION LOGIC ---
  window.addEventListener('load', () => {
    // 1. Register the Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('Service Worker registrado', reg))
        .catch(err => console.error('Error al registrar Service Worker', err));
    }
    
    // 2. Initial UI update
    updateMedicationStatusUI();
    setInterval(updateMedicationStatusUI, 60000);

    // 3. Button logic
    const notificationBtn = document.getElementById('enable-notifications-btn');
    const notificationStatus = document.getElementById('notification-status');
    
    if ('Notification' in window && Notification.permission === 'granted') {
        notificationStatus.textContent = 'Las notificaciones est√°n activadas.';
        notificationBtn.style.display = 'none';
    } else if ('Notification' in window && Notification.permission === 'denied') {
        notificationStatus.textContent = 'Notificaciones bloqueadas.';
        notificationBtn.style.display = 'none';
    }

    notificationBtn.addEventListener('click', async () => {
      if (!('Notification' in window) || !('showTrigger' in Notification.prototype)) {
        notificationStatus.textContent = 'Este navegador no soporta notificaciones programadas.';
        return;
      }

      const permission = await Notification.requestPermission();
      
      if (permission === 'granted') {
        notificationStatus.textContent = '¬°Notificaciones activadas con √©xito!';
        notificationBtn.style.display = 'none';
        await scheduleAllNotifications();
      } else {
        notificationStatus.textContent = 'Permiso de notificaciones denegado.';
      }
    });
  });

  async function scheduleAllNotifications() {
      const registration = await navigator.serviceWorker.getRegistration();
      if (!registration) {
          console.error("No hay un Service Worker registrado.");
          return;
      }
      
      const existingNotifications = await registration.getNotifications({includeTriggered: true});
      existingNotifications.forEach(notification => notification.close());
      console.log('Notificaciones previas borradas.');

      const timeBlocks = document.querySelectorAll('.time-block');
      
      for(const block of timeBlocks) {
          const medName = block.querySelector('.font-bold').textContent.trim();
          const [hours, minutes] = block.dataset.time.split(':').map(Number);
          
          const now = new Date(new Date().toLocaleString('en-US', { timeZone: 'America/Bogota' }));
          const notificationTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, 0);
          
          if (notificationTime.getTime() < now.getTime()) {
              notificationTime.setDate(notificationTime.getDate() + 1);
          }
          
          try {
              await registration.showNotification('Hora de tu medicamento', {
                  body: `Es hora de tomar: ${medName}`,
                  tag: `med-${block.id}-${notificationTime.getDate()}`,
                  icon: 'icons/icon-192x192.png',
                  badge: 'icons/icon-72x72.png',
                  showTrigger: new TimestampTrigger(notificationTime.getTime()),
                  requireInteraction: true
              });
              console.log(`Notificaci√≥n programada para ${medName} a las ${notificationTime.toLocaleTimeString()}`);
          } catch(e) {
              console.error(`Error al programar notificaci√≥n para ${medName}: `, e);
              document.getElementById('notification-status').textContent = 'Error: Notificaciones programadas no soportadas.';
          }
      }
  }
</script>

</body>
</html>